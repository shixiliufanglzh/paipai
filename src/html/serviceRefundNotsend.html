<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <script>
        (function (doc, win) {
            var docEl = doc.documentElement,
                    resizeEvt = 'orientationchange' in window ? 'orientationchange' : 'resize',
                    recalc = function () {
                        var clientWidth = docEl.clientWidth;
                        if (!clientWidth) return;
                        if(clientWidth>=640){
                            docEl.style.fontSize = '100px';
                        }else{
                            docEl.style.fontSize = 100 * (clientWidth / 750) + 'px';
                        }
                    };

            if (!doc.addEventListener) return;
            win.addEventListener(resizeEvt, recalc, false);
            doc.addEventListener('DOMContentLoaded', recalc, false);
        })(document, window);
    </script>
    <link rel="stylesheet" href="../style/service.css">
</head>
<body>
<div id="serviceDetail">

    <div id="goodDetail">
        <div class="good_msg clearfix">
            <span class="img"></span>
            <div class="product_desc">
                <p class="name">商品</p>
                <p class="parameter">参数</p>
            </div>
            <div class="price"><span class="price_now">￥3999.00</span><br><span class="price_primary">4999.00</span><br><span class="count">×2</span></div>
        </div>
    </div>

    <div id="fillMsg">
        <div class="form_group clearfix">
            <span class="required">*</span>
            <label>申请服务：</label>
            <span class="content">退款</span>
        </div>
        <div class="form_group clearfix">
            <span class="required">*</span>
            <label>退款原因：</label>
            <select class="reason_sel">
                <option disabled selected value>选择退款原因</option>
                <option value="拍错/多拍/不想要">拍错/多拍/不想要</option>
                <option value="与商家协商一致退款">与商家协商一致退款</option>
                <option value="缺货">缺货</option>
                <option value="未按约定时间发货">未按约定时间发货</option>
                <option value="其它">其它</option>
            </select>
        </div>
        <div class="form_group clearfix">
            <span class="required">*</span>
            <label>退款金额：</label>
            <span class="content">￥<span class="count total_count">3999.00</span></span>
        </div>
        <p class="count_prompt">最多退款￥<span class="most_count">3999.00</span>，包含快递费￥<span class="postage">0.00</span></p>
    </div>

    <div id="addition">
        <h3>补充说明：</h3>
        <textarea></textarea>
    </div>

    <button id="msgSubmit">提交</button>
</div>



</body>
<script src="../../bower_components/jquery/dist/jquery.min.js"></script>
<script src="../script/paipaiCompnt.js"></script>

<script>
    var $curOrderId = commonCompt.GetUrlPara('orderId');
    var $curGoodId = commonCompt.GetUrlPara('goodsId');
    var $orderGoodsId = commonCompt.GetUrlPara('orderGoodsId');
    var $refundMoney = 0;

    $(function(){
        $.ajax({
            url: GETORDERGOODS,
            data: {
                orderGoodsId: $orderGoodsId
            },
            type:'GET',
            dataType:'json',
            async:false,
            success:function(data){
                console.log(data);
                apiResponse(data.responseCode,data.responseDesc);
                if(data.responseCode == 2000){
                    var goodMsg = data.data;
                    $('.good_msg .img').css({
                        'background': 'url("'+ goodMsg.goodsPic +'") center center no-repeat',
                        'background-size': 'cover',
                        '-webkit-background-size': 'cover'
                    });
                    $('.good_msg .name').html(goodMsg.goodsName);
                    $('.good_msg .parameter').html(goodMsg.goodsSpu);
                    $('.good_msg .price_now').html('￥' + goodMsg.buyPrice);
                    $('.good_msg .price_primary').html(goodMsg.salePrice);
                    $('.good_msg .count').html('×' + goodMsg.goodsAmount);
                    $refundMoney = goodMsg.totalPrice;
                    $('.total_count,.most_count').html($refundMoney);
                }
            },
            error: function(err){
                console.log(err);
            }
        })
    })


    $('#msgSubmit').click(function(){
//        console.log("待提交：",imgListBase64);
        var $reason = $('.reason_sel').val();
        if(!$reason){
            commonCompt.popPrompt("请选择退款原因");
        }else {
            var dataPara = {
                orderId: $curOrderId,
                goodsId: $curGoodId,
                refundType: 1,
                refundReason: $reason,
                refundMoney: $refundMoney,
                refundDesc: $('#addition textarea').val()

            };
            console.log(dataPara);
            $.ajax({
                url: APPLYSERVER,
                data: dataPara,
                type:'post',
                dataType:'json',
//                async:false,
                success:function(data){
                    console.log(data);
                    apiResponse(data.responseCode,data.responseDesc);
                    if(data.responseCode == 2000){
                        commonCompt.popPrompt('已提交申请');
                        setTimeout(function(){
                            window.location.href = document.referrer;
                        },2000)
                    }
                },
                error: function(err){
                    console.log(err);
                }
            })
        }
    })




</script>
</html>