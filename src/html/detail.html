<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <script>
        (function (doc, win) {
            var docEl = doc.documentElement,
                    resizeEvt = 'orientationchange' in window ? 'orientationchange' : 'resize',
                    recalc = function () {
                        var clientWidth = docEl.clientWidth;
                        if (!clientWidth) return;
                        if(clientWidth>=640){
                            docEl.style.fontSize = '100px';
                        }else{
                            docEl.style.fontSize = 100 * (clientWidth / 750) + 'px';
                        }
                    };

            if (!doc.addEventListener) return;
            win.addEventListener(resizeEvt, recalc, false);
            doc.addEventListener('DOMContentLoaded', recalc, false);
        })(document, window);
    </script>
    <link rel="stylesheet" href="../../bower_components/swiper/dist/css/swiper.min.css">
    <link rel="stylesheet" href="../style/detail.css">
</head>
<body>
<div id="goodDetail">
    <div class="swiper-container">
        <div class="swiper-wrapper">
            <div class="swiper-slide"></div>
        </div>
        <div class="swiper-pagination"></div>
    </div>

    <section id="summary">
        <p class="desc">某低级搜集冬季加大技术敖东瓶塞哦思技术敖东瓶塞哦思考pop、 哦外婆fsasjdiiss似懂非懂</p>
        <div class="price_now">
            <span class="cur_price">￥0.00</span>
            <!--<span class="rate">减价频率：1次/S&nbsp;&nbsp;&nbsp;&nbsp;减价幅度：0.01元/次</span>-->
            <!--<span class="rate">减价抢拍时间：(每天8:00-24:00)</span>-->
            <span class="rate">距正式减拍还有<span class="left_time">0天0时0分0秒</span></span>
        </div>
        <div class="relevant_price clearfix">
            <span class="primary">起拍价：<span class="primary_range">￥0.00-0.00</span></span>
            <span class="market">市场价：<span class="market_range">￥0.00-0.00</span></span>
        </div>
        <div class="relevant_count clearfix">
            <span class="store">库存：<span class="store_count">9999件</span></span>
            <span class="sold">已拍：<span class="sold_count">999件</span></span>
        </div>
    </section>

    <section id="features" class="clearfix">
        <div><i></i><span>正品保证</span></div>
        <div><i></i><span>公正公开</span></div>
        <div><i></i><span>七天退换</span></div>
        <div><i></i><span>闪电发货</span></div>
    </section>

    <section id="production">
        <div class="sorts_sel"><span>选择颜色分类</span><i></i></div>
        <div class="rule">
            <h5>抢拍规则</h5>
            <div class="rule_content">
                <div class="single_rule">
                    <h6><i class="one"></i><span>正价减拍</span></h6>
                    <p>商品由正价开始减价，每隔一段时间减价一次</p>
                </div>
                <div class="single_rule">
                    <h6><i class="two"></i><span>一拍即中</span></h6>
                    <p>商品减价过程中，首个抢拍的买家，即以当前价成交</p>
                </div>
                <div class="single_rule">
                    <h6><i class="three"></i><span>循环反复</span></h6>
                    <p>抢拍成功后，商品重新从正价开始减价，进入新的抢拍</p>
                </div>
            </div>
        </div>
    </section>

    <section id="about">
        <div class="nav">
            <div class="tab current">商品详情</div>
            <div class="tab">成交记录</div>
            <div class="tab">用户评价</div>
        </div>
        <div class="about_sorts">
            <div class="good_detail">这里是商品详情内容</div>

            <div class="deal_record">
                <div class="single_deal">
                    <div class="deal_msg"><span class="name">136****5342</span><span class="time">2017-08-15 08:28</span></div>
                    <div class="deal_detail">
                        <span class="deal_price">￥3999.23</span>
                        <p class="parameter">颜色：黄绿色 尺寸：235L 型号：SFGGR25ac</p>
                        <p class="count">数量：1</p>
                    </div>
                </div>
                <div class="single_deal">
                    <div class="deal_msg"><span class="name">136****5342</span><span class="time">2017-08-15 08:28</span></div>
                    <div class="deal_detail">
                        <span class="deal_price">￥3999.23</span>
                        <p class="parameter">颜色：黄绿色 尺寸：235L 型号：SFGGR25ac</p>
                        <p class="count">数量：2</p>
                    </div>
                </div>
                <div class="single_deal">
                    <div class="deal_msg"><span class="name">136****5342</span><span class="time">2017-08-15 08:28</span></div>
                    <div class="deal_detail">
                        <span class="deal_price">￥3999.23</span>
                        <p class="parameter">颜色：黄绿色 尺寸：235L 型号：SFGGR25ac</p>
                        <p class="count">数量：3</p>
                    </div>
                </div>
            </div>

            <div class="evaluate_list">
                <div class="single_evaluate">
                    <div class="evaluate_msg"><span class="name">136****5342</span><span class="time">2017-08-15 08:28</span></div>
                    <p class="evaluate_content">啊大煞风景哈斯看见的恢复开机开机速度封口机哈萨克交电话费客家话代课教师当时的解放军爱死基地</p>
                    <!--<div class="imgs"><span></span><span></span><span></span><span></span></div>-->
                    <p class="good_para">颜色分类：E90无花是实惠色 颜色分类：E90无花是实惠色</p>
                </div>
                <div class="single_evaluate">
                    <div class="evaluate_msg"><span class="name">136****5342</span><span class="time">2017-08-15 08:28</span></div>
                    <p class="evaluate_content">啊大煞风景哈斯看见的恢复开机开机速度封口机哈萨克交电话费客家话代课教师当时的解放军爱死基地</p>
                    <div class="imgs"><span></span><span></span><span></span><span></span></div>
                    <p class="good_para">颜色分类：E90无花是实惠色 颜色分类：E90无花是实惠色</p>
                </div>
                <div class="single_evaluate">
                    <div class="evaluate_msg"><span class="name">136****5342</span><span class="time">2017-08-15 08:28</span></div>
                    <p class="evaluate_content">啊大煞风景哈斯看见的恢复开机开机速度封口机哈萨克交电话费客家话代课教师当时的解放军爱死基地</p>
                    <div class="imgs"><span></span><span></span><span></span><span></span></div>
                    <p class="good_para">颜色分类：E90无花是实惠色 颜色分类：E90无花是实惠色</p>
                </div>
            </div>
        </div>
    </section>

    <div id="action">
        <div class="action_wrap">
            <button class="chat"><i></i></button>
            <button class="like"><i></i><span>加入关注</span></button>
            <button class="purchase"><i></i><span>正价购买</span></button>
        </div>
    </div>
</div>

<div id="sortsList">
    <div class="sorts_wrap">
        <i class="close"></i>
        <div class="good_img"></div>
        <div class="basic_para">
            <div class="cur_price">当前价：<span>￥39990.00</span></div>
            <div class="start_price">起拍价：<span>￥39990.00</span></div>
            <div class="left_price">库&nbsp;&nbsp;&nbsp;存：<span>154564件</span></div>
        </div>

        <div class="parameters">
            <div class="sorts_para">
                <h6>请选择参数</h6>
                <!--<div class="single_para_container">-->
                    <!--<h4>尺寸</h4>-->
                    <!--<div class="sorts">-->
                        <!--<span>20寸</span>-->
                        <!--<span>22寸</span>-->
                        <!--<span>24寸</span>-->
                        <!--<span>26寸</span>-->
                        <!--<span>28寸</span>-->
                        <!--<span>30寸</span>-->
                        <!--<span>32寸</span>-->
                    <!--</div>-->
                <!--</div>-->

            </div>

            <div class="count_sel clearfix">
                <div class="limit">购买数量<span>（限购3件）</span></div>
                <div class="count">
                    <i class="minus"></i>
                    <span class="count_num">0</span>
                    <i class="plus"></i>
                </div>
            </div>

            <div class="consume">
                <h4>消耗</h4>
                <p>1拍币（剩余23拍币）</p>
            </div>
        </div>

        <div id="bottomBtn" class="intension">
            <button class="like">加入关注</button>
            <button class="purchase">立即竞拍</button>
        </div>
    </div>
</div>
</body>
<script src="../../bower_components/jquery/dist/jquery.min.js"></script>
<script src="../../bower_components/swiper/dist/js/swiper.jquery.min.js"></script>
<script src="../script/paipaiCompnt.js"></script>
<script>
    var goodsPara = {
        imgs: ["../imgs/detail_01.jpg","../imgs/detail_02.jpg","../imgs/detail_03.jpg"],
        title: "某低级搜集反对法发v集反对法发vDVDDVD是dffdd韩国ref",
        rate: 0.03,
        price_now: 1111111.26,
        price_primary: [777777.77,898989.99],
        price_market: [799997.77,943534.99],
        state: 0,  //0:减价中 1：待拍中 2：已售罄
        store: 999,
        sold: 777,
        timeLeft: 234567,
        purchase_limit: 5,
        token_left: 63,
        token_consume: 2,
        paras_arr: [
            {
                type_id: 11,
                type_name: "尺寸",
                paras: [
                    {
                        para_id: 1,
                        value: "20寸",
                        stock: true
                    },
                    {
                        para_id: 2,
                        value: "22寸",
                        stock: false
                    },
                    {
                        para_id: 3,
                        value: "24寸",
                        stock: true
                    },
                    {
                        para_id: 4,
                        value: "26寸",
                        stock: true
                    },
                    {
                        para_id: 5,
                        value: "28寸",
                        stock: false
                    },
                    {
                        para_id: 6,
                        value: "30寸",
                        stock: true
                    },
                    {
                        para_id: 7,
                        value: "32寸",
                        stock: true
                    }
                ]
            },
            {
                type_id: 22,
                type_name: "颜色",
                paras: [
                    {
                        para_id: 1,
                        value: "红色",
                        stock: true
                    },
                    {
                        para_id: 2,
                        value: "绿色",
                        stock: false
                    },
                    {
                        para_id: 3,
                        value: "蓝色",
                        stock: true
                    },
                    {
                        para_id: 4,
                        value: "黑色",
                        stock: true
                    }
                ]
            }
        ]
    };
    var summaryTimer = null;
    var userSel = {
        count: 0,
        type_id: [],
        para_id: []
    }


    $(function(){

        //价格、库存等信息展示
        $('#summary .desc').html(goodsPara.title);
        $('#summary .primary_range').html('￥'+ goodsPara.price_primary[0] +'-'+ goodsPara.price_primary[1]);
        $('#summary .market_range').html('￥'+ goodsPara.price_market[0] +'-'+ goodsPara.price_market[1]);
        $('#summary .sold_count').html(goodsPara.sold +'件');
        $('#summary .cur_price').html('￥'+goodsPara.price_now);
        $('#sortsList .cur_price span').html('￥'+goodsPara.price_now);
        $('#sortsList .start_price span').html('￥'+ goodsPara.price_primary[0] +'-'+ goodsPara.price_primary[1]);
        $('#sortsList .left_price span').html(goodsPara.store +'件');
        $('#sortsList .consume p').html(goodsPara.token_consume +'拍币（剩余'+ goodsPara.token_left +'拍币）');

        if(goodsPara.purchase_limit > 0){
            $('#summary .store_count').html(goodsPara.store +'件（每次限拍'+ goodsPara.purchase_limit +'件）');
            $('#sortsList .count_sel .limit span').html('（限购'+ goodsPara.purchase_limit +'件）');

        }else {
            $('#summary .store_count').html(goodsPara.store +'件');
        }

        //产品参数展示与操作
        (function(){
            //商品规格参数展示
            for(var i=0; i<goodsPara.paras_arr.length; i++){
                var paraWrapHtml = '';
                paraWrapHtml += '<div class="single_para_container" data-type-id="'+ goodsPara.paras_arr[i].type_id +'">'+
                                    '<h4>'+ goodsPara.paras_arr[i].type_name +'</h4>'+
                                    '<div class="sorts">';
                for(var j=0; j<goodsPara.paras_arr[i].paras.length; j++){
                    var stock = "";
                    stock = goodsPara.paras_arr[i].paras[j].stock ? "" : "short";
                    paraWrapHtml += '<span class="'+ stock +'" data-para-id="'+ goodsPara.paras_arr[i].paras[j].para_id +'">'+ goodsPara.paras_arr[i].paras[j].value +'</span>';
                }
                paraWrapHtml +=     '</div>'+
                                '</div>';

                $('#sortsList .sorts_para').append(paraWrapHtml);
            }

            //商品参数选择


        })()

        //判断是否在减价拍时间范围内
        if(goodsPara.state == 0){
            var timestamp=new Date().getTime();
            var todayTimestamp = timestamp % 86400000;
//            console.log(todayTimestamp);
            if(todayTimestamp > 57600000){
                $('.action_wrap .purchase span').html('正价拍');
                $('#sortsList .purchase').html('正价购买');
                $('.rate').html('减价抢拍时间：(每天8:00-24:00)');
            }else {
                $('.action_wrap .purchase span').html('减价拍');
                $('#sortsList purchase').html('立即抢拍');
                $('.rate').html('减价频率：1次/S&nbsp;&nbsp;&nbsp;&nb' +
                        'sp;减价幅度：'+ goodsPara.rate +'元/次');
            }

            summaryTimer = setInterval(function(){
                goodsPara.price_now = commonCompt.accSub(goodsPara.price_now,goodsPara.rate);
                $('#summary .cur_price').html('￥'+goodsPara.price_now);
                $('#sortsList .cur_price span').html('￥'+goodsPara.price_now);
            },1000);

        }else if(goodsPara.state == 1){
            //倒计时
            var timerList = [];
            var addOrderTimer = new Paipai;
            addOrderTimer.addOrderTimer(goodsPara.timeLeft,$('.rate .left_time'),timerList);
            $('.action_wrap .purchase span').html('正价购买');
            $('#sortsList .purchase').html('正价购买');

        }else if(goodsPara.state == 2){
            $('.action_wrap .purchase span').html('已售罄');
            $('.purchase').attr('disabled','disabled');
            $('#sortsList .purchase').html('已售罄');
            $('.purchase').css('background-color','#858585');
            $('.rate').hide();
        }

        //轮播图
        (function(){
            var imgsCount = goodsPara.imgs.length;
            $('.swiper-container-detail .swiper-wrapper').html('');
            for(var i=0; i<imgsCount; i++){
                $('.swiper-container .swiper-wrapper').append('<div class="swiper-slide" style="background:url('+ goodsPara.imgs[i] +') center center no-repeat;background-size: cover;-webkit-background-size: cover;"></div>')
            }
        })()
        var mySwiper = new Swiper ('.swiper-container', {
            direction: 'horizontal',
            loop: true,
            autoplay: 3000,
            pagination : '.swiper-pagination'
        })

    })

    $('.action_wrap .like,.action_wrap .purchase,#production .sorts_sel').click(function(){
        $('#sortsList').fadeIn(300);
    })
    $('.close').click(function(){
        $('#sortsList').fadeOut(300);
    })

    $('.single_para_container .sorts').on('click', 'span', function(){
        //$(this).
    })


    //购买数量
    $('#sortsList .minus').click(function(){
        if(userSel.count > 0)  userSel.count --;
        $('#sortsList .count_num').html(userSel.count);
    })
    $('#sortsList .plus').click(function(){
        if(userSel.count < goodsPara.purchase_limit) userSel.count ++;
        $('#sortsList .count_num').html(userSel.count);
        console.log(userSel);
    })

    //选择参数
    $('#sortsList .sorts_para').on('click', 'span',function(){
        if(!$(this).hasClass('short')){
            $(this).siblings().removeClass('selected');
            $(this).addClass('selected');

            var type_id = $(this).parents('.single_para_container').attr('data-type-id');
            var para_id = $(this).attr('data-para-id');
            var flag_exist = false;
            for(var i=0; i<userSel.type_id.length; i++){
                if(userSel.type_id[i] == type_id){
                    flag_exist = true;
                    userSel.para_id[i] = para_id;
                }
            }
            if(!flag_exist){
                userSel.type_id.push(type_id);
                userSel.para_id.push(para_id);
            }
        }


    })

    //商品详情、成交记录、用户评价 切换
    $('#about .nav').on('click','.tab',function(){
        var curIndex = $(this).index();
        $('#about .nav .tab').removeClass('current');
        $(this).addClass('current');
        $('.about_sorts>div').hide();
        $('.about_sorts>div').eq(curIndex).show();
    })



</script>
</html>